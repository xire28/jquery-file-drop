!function(e,n){e.fileDropContainer=function(t,r){var a=this,i=function(e){e.preventDefault(),e.stopPropagation()};a.generateOptions=function(n){var t=e.extend(!0,{},e.fileDropContainer.defaultBaseOptions,n),r=a.$el,i=r.closest("form"),o=i[0],f=i.find('input[name="'+t.tokenName+'"]');if(!t.url)throw"Cannot create file drop container, upload url is not defined";if(!o)throw"Cannot create file drop container, parent `form` not found for:\n"+a.el.outerHTML;var s={beforeSend:a.triggerOnContainer("ajax:beforeSend"),complete:a.triggerOnContainer("ajax:complete"),success:a.triggerOnContainer("ajax:success"),error:a.triggerOnContainer("ajax:error"),data:{},info:{data:{}}};return f[0]&&(s.data[t.tokenName]=f.val()),t.info.url&&(f[0]&&(s.info.data[t.tokenName]=f.val()),e.extend(s.info,{beforeSend:a.triggerOnContainer("info:ajax:beforeSend"),success:a.triggerOnContainer("info:ajax:success"),complete:a.triggerOnContainer("info:ajax:complete"),error:a.triggerOnContainer("info:ajax:error")})),e.extend(!0,{},s,t)},a.acceptFiles=function(t,r){var i=(a.$el,[]),o=e.grep(t,function(e){var t=new n.RegExp((r||"*").replace("*",".*").replace("+","+").replace(".",".")).test(e.type);return t||i.push(e),t});return a.triggerOnContainer("files:deny",i),o},a.processFiles=function(n,t){return a.acceptFiles(e.makeArray(n),t)},a.sendFileInfos=function(n,t,r){if(!r.scopeOnly){var a={},i=e.map(t,function(e){return{name:e.name,size:e.size,type:e.type,last_modified:e.lastModified}});a[n]=i,e.extend(r,{data:a})}e.ajax(r)},a.sendFiles=function(t,r,a){var i=new n.FormData;return e.each(r,function(e,n){i.append(t,n)}),a.data[a.tokenName]&&i.append(a.tokenName,a.data[a.tokenName]),e.ajax(e.extend({},a,{data:i}))},a.listener=function(n,t){i(t);var r=n.attr("name"),o=r.replace(/\[\]$/,""),f=a.processFiles(t.originalEvent.dataTransfer?t.originalEvent.dataTransfer.files:t.target.files,n.attr("accept")),s=a.options;if(f.length){var l=a.sendFiles(r,f,s);a.triggerOnContainer("files:upload",f,l),s.info.url&&(e.extend(s.info.scope,{files:f,uploadRequest:l}),a.sendFileInfos(o,f,s.info))}},a.init=function(e){if(n.File&&n.FileList&&n.FileReader){var t=a.$el,r=t.find('input[type="file"]').first(),o=a.listener.bind(a,r);a.options=a.generateOptions(e),t.on("drop",o).on("dragover dragenter",i).on("click",function(){r.click()}),r.on("click",function(e){e.stopPropagation()}).on("change",o).detach()}},a.triggerOnContainer=function(e){return function(){a.$el.trigger(e,arguments)}},a.$el=e(t),a.el=t,a.$el.data("fileDropContainer",a),a.init(r)},e.fileDropContainer.defaultBaseOptions={contentType:"multipart/form-data; charset=UTF-8",method:"post",processData:!1,tokenName:"authenticity_token",info:{method:"post",scope:{},scopeOnly:!1}},e.fn.fileDropContainer=function(n){return this.each(function(){new e.fileDropContainer(this,n)})},e.fn.getfileDropContainer=function(){this.data("fileDropContainer")}}(jQuery,window);