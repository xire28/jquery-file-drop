!function(e,n){e.fileDropContainer=function(t,a){var i=this,o=function(e){e.preventDefault(),e.stopPropagation()};i.generateOptions=function(n){var t=e.extend(!0,{},e.fileDropContainer.defaultBaseOptions,n),a=i.$el,o=a.closest("form"),r=o[0],f=o.find('input[name="'+t.tokenName+'"]'),s=a.trigger;if(!t.url)throw"Cannot create file drop container, upload url is not defined";if(!r)throw"Cannot create file drop container, parent `form` not found for:\n"+i.el.outerHTML;var l={beforeSend:s.bind(a,"ajax:beforeSend"),complete:s.bind(a,"ajax:complete"),success:s.bind(a,"ajax:success"),error:s.bind(a,"ajax:error"),data:{},info:{data:{}}};return f[0]&&(l.data[t.tokenName]=f.val()),t.info.url&&(f[0]&&(l.info.data[t.tokenName]=f.val()),e.extend(l.info,{beforeSend:s.bind(a,"info:ajax:beforeSend"),success:s.bind(a,"info:ajax:success"),complete:s.bind(a,"info:ajax:complete"),error:s.bind(a,"info:ajax:error")})),e.extend(!0,{},l,t)},i.acceptFiles=function(t,a){var o=i.$el,r=[],f=e.grep(t,function(e){var t=new n.RegExp((a||"*").replace("*",".*").replace("+","+").replace(".",".")).test(e.type);return t||r.push(e),t});return o.trigger("files:deny",[r]),f},i.processFiles=function(n,t){return i.acceptFiles(e.makeArray(n),t)},i.sendFileInfos=function(n,t,a){if(!a.scopeOnly){var i={},o=e.map(t,function(e){return{name:e.name,size:e.size,type:e.type,last_modified:e.lastModified}});i[n]=o,e.extend(a,{data:i})}e.ajax(a)},i.sendFiles=function(t,a,i){var o=new n.FormData;return e.each(a,function(e,n){o.append(t,n)}),i.data[i.tokenName]&&o.append(i.tokenName,i.data[i.tokenName]),e.ajax(e.extend({},i,{data:o}))},i.listener=function(n,t){o(t);var a=n.attr("name"),r=a.replace(/\[\]$/,""),f=i.processFiles(t.originalEvent.dataTransfer?t.originalEvent.dataTransfer.files:t.target.files,n.attr("accept")),s=i.options;if(f.length){var l=i.sendFiles(a,f,s);i.$el.trigger("files:upload",[f,l]),s.info.url&&(e.extend(s.info.scope,{files:f,uploadRequest:l}),i.sendFileInfos(r,f,s.info))}},i.init=function(e){if(n.File&&n.FileList&&n.FileReader){var t=i.$el,a=t.find('input[type="file"]').first(),r=i.listener.bind(i,a);i.options=i.generateOptions(e),t.on("drop",r).on("dragover dragenter",o).on("click",function(){a.click()}),a.on("click",function(e){e.stopPropagation()}).on("change",r).detach()}},i.$el=e(t),i.el=t,i.$el.data("fileDropContainer",i),i.init(a)},e.fileDropContainer.defaultBaseOptions={contentType:"multipart/form-data; charset=UTF-8",method:"post",processData:!1,tokenName:"authenticity_token",info:{method:"post",scope:{},scopeOnly:!1}},e.fn.fileDropContainer=function(n){return this.each(function(){new e.fileDropContainer(this,n)})},e.fn.getfileDropContainer=function(){this.data("fileDropContainer")}}(jQuery,window);